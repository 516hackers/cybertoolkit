#!/bin/bash
# Nuclei Wrapper - 516 Hackers Toolkit

set -e

LOG_DIR="../../logs"
mkdir -p "$LOG_DIR"
LOG_FILE="$LOG_DIR/nuclei_$(date +%Y%m%d_%H%M%S).log"

echo "[516] Nuclei Wrapper - Starting template-based vulnerability scanning" | tee -a "$LOG_FILE"

if ! command -v nuclei &> /dev/null; then
    echo "Error: nuclei not found. Install with:" | tee -a "$LOG_FILE"
    echo "  Go: go install -v github.com/projectdiscovery/nuclei/v2/cmd/nuclei@latest" | tee -a "$LOG_FILE"
    exit 1
fi

if [ $# -eq 0 ]; then
    echo "Usage: $0 <target> [template]" | tee -a "$LOG_FILE"
    echo "Example: $0 http://example.com" | tee -a "$LOG_FILE"
    echo "Example: $0 http://example.com -t vulnerabilities/" | tee -a "$LOG_FILE"
    exit 1
fi

TARGET=$1
shift
TEMPLATES=$@

echo "[516] Target: $TARGET" | tee -a "$LOG_FILE"

if [ -z "$TEMPLATES" ]; then
    nuclei -u "$TARGET" -silent | tee -a "$LOG_FILE"
else
    nuclei -u "$TARGET" -t "$TEMPLATES" -silent | tee -a "$LOG_FILE"
fi

echo "[516] Nuclei scan completed" | tee -a "$LOG_FILE"
